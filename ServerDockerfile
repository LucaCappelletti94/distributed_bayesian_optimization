FROM ray-project/deploy

WORKDIR /home
COPY . .
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8
RUN pip install pip --upgrade && pip install -r requirements.txt --upgrade
RUN apt-get update -qyy && apt-get install htop byobu python3-dev libasound2-dev vim nano pssh -qyy
RUN curl -sL https://deb.nodesource.com/setup_13.x | bash - && apt-get install -y nodejs
RUN pip install ipywidgets && jupyter nbextension enable --py widgetsnbextension
RUN cd /ray/python/ray/dashboard/client && npm ci && npm run build

# Create the jailed user
RUN useradd -ms "/bin/bash" jaileduser
# Set user password
RUN echo "jaileduser:plz_change_this_321" | chpasswd 
# Clean the evironment variable of the user
RUN echo "export PATH=''\n" >> /home/jaileduser/.bashrc
# Set the restricted bash
RUN chsh -s /bin/rbash jaileduser