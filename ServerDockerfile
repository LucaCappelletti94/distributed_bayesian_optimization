FROM ray-project/deploy

WORKDIR /home
COPY . .
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8
RUN pip install pip --upgrade && pip install -r requirements.txt --upgrade
RUN apt-get update -qyy && apt-get install htop byobu python3-dev libasound2-dev vim nano pssh -qyy
RUN curl -sL https://deb.nodesource.com/setup_13.x | bash - && apt-get install -y nodejs
RUN pip install ipywidgets && jupyter nbextension enable --py widgetsnbextension
RUN cd /ray/python/ray/dashboard/client && npm ci && npm run build

# Install the restricted bash
RUN apt-get update -qyy && apt-get install -qyy rbash
# Create the jailed user
RUN useradd -ms $(which rbash) jaileduser
# Set user password
RUN echo "plz_change_this_321" | passwd --stdin jaileduser
# Clean the evironment variable of the user
RUN su - jaileduser -c "for c in $(set | cut -d '=' -f 1); do unset $c; done"
# Make it's home non  usable
RUN chmod 0000 /home/jaileduser